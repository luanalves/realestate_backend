{
	"info": {
		"_postman_id": "quicksol-api-complete-2026",
		"name": "Quicksol Real Estate API - Complete (29 Endpoints)",
		"description": "Collection completa da API Quicksol Real Estate com 29 endpoints, autentica√ß√£o JWT/OAuth 2.0, multi-tenancy e dados de teste realistas.\n\n**‚úÖ Atualizado em: 16/01/2026**\n**üìä Total de endpoints: 29**\n**üîí Session Validation: Added to logout endpoint (ADR-011)**\n\n**Configura√ß√£o Inicial:**\n1. Import no Postman\n2. Configure environment ou use vari√°veis da collection\n3. Execute \"Get OAuth Token\" primeiro para obter bearer token\n4. Execute \"User Login\" para criar sess√£o (session_id salvo automaticamente)\n5. Os tokens e session_id s√£o salvos automaticamente nas vari√°veis\n6. Explore os endpoints - todos exceto login requerem session_id\n\n**Categorias:**\n- üîê Authentication (OAuth + Users): 8 endpoints\n- üë§ Agents: 7 endpoints\n- üè† Properties: 4 endpoints\n- üìã Assignments: 3 endpoints\n- üí∞ Commissions: 4 endpoints\n- üìä Performance: 2 endpoints\n- üìö Master Data: 5 endpoints\n\n**Security Model (ADR-011 - Dual Authentication):**\n- Login: Bearer token only (creates session)\n- All other User Auth endpoints: Bearer token + Session required\n- Session validation includes fingerprint check (IP/User-Agent/Language)\n- Session stored in Redis with 7200s TTL\n\n**ADRs Implementadas:**\n- ADR-005: OpenAPI 3.0 Documentation\n- ADR-007: HATEOAS Hypermedia\n- ADR-008: Multi-tenancy Security\n- ADR-009: Headless Authentication\n- ADR-011: Controller Security (@require_jwt + @require_session + @require_company)\n\n**Variables Used:**\n- {{base_url}}: http://localhost:8069\n- {{access_token}}: OAuth 2.0 bearer token (auto-saved)\n- {{session_id}}: HTTP session ID (auto-saved from login)\n- {{user_id}}: Current user ID (auto-saved)\n- {{user_email}}: Current user email (auto-saved)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "üîê 1. OAuth Authentication",
			"item": [
				{
					"name": "Get OAuth Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.access_token) {",
									"        pm.environment.set('access_token', jsonData.access_token);",
									"        pm.collectionVariables.set('access_token', jsonData.access_token);",
									"        console.log('‚úÖ OAuth token salvo');",
									"    }",
									"    if (jsonData.refresh_token) {",
									"        pm.environment.set('refresh_token', jsonData.refresh_token);",
									"        pm.collectionVariables.set('refresh_token', jsonData.refresh_token);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"grant_type\": \"client_credentials\",\n    \"client_id\": \"your_client_id_here\",\n    \"client_secret\": \"your_client_secret_here\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/token",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "token"]
						},
						"description": "OAuth 2.0 Client Credentials Grant.\n\n**Como obter credenciais:**\n1. Acesse Odoo ‚Üí Configura√ß√µes ‚Üí API Gateway ‚Üí OAuth Applications\n2. Crie nova aplica√ß√£o\n3. Copie client_id e client_secret\n\n**Token √© salvo automaticamente**"
					},
					"response": []
				},
				{
					"name": "Refresh OAuth Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set('access_token', jsonData.access_token);",
									"    pm.collectionVariables.set('access_token', jsonData.access_token);",
									"    console.log('‚úÖ Token renovado');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refresh_token\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/refresh",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "refresh"]
						},
						"description": "Renova access_token expirado usando refresh_token.\n\n**Quando usar:** Token expira ap√≥s 3600s (1 hora)"
					},
					"response": []
				},
				{
					"name": "Revoke OAuth Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"token\": \"{{access_token}}\",\n    \"token_type_hint\": \"access_token\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/revoke",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "revoke"]
						},
						"description": "Revoga (invalida) um token ativo.\n\n**Uso:** Logout, seguran√ßa"
					},
					"response": []
				}
			],
			"description": "OAuth 2.0 token management (RFC 6749)"
		},
		{
			"name": "üë§ 2. User Authentication",
			"item": [
				{
					"name": "User Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    ",
									"    // Save session_id from response",
									"    if (jsonData.session_id) {",
									"        pm.environment.set('session_id', jsonData.session_id);",
									"        pm.collectionVariables.set('session_id', jsonData.session_id);",
									"        console.log('‚úÖ Session ID saved: ' + jsonData.session_id);",
									"    }",
									"    ",
									"    // Save session_id from cookies",
									"    const cookies = pm.cookies.toObject();",
									"    if (cookies.session_id) {",
									"        pm.environment.set('session_id', cookies.session_id);",
									"        pm.collectionVariables.set('session_id', cookies.session_id);",
									"        console.log('‚úÖ Session cookie captured: ' + cookies.session_id);",
									"    }",
									"    ",
									"    // Save user data",
									"    if (jsonData.user && jsonData.user.id) {",
									"        pm.collectionVariables.set('user_id', jsonData.user.id);",
									"        pm.collectionVariables.set('user_email', jsonData.user.email);",
									"        console.log('‚úÖ User ID saved: ' + jsonData.user.id);",
									"    }",
									"    ",
									"    console.log('‚úÖ Login successful - token and session ready');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin\",\n    \"password\": \"admin\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/users/login",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "login"]
						},
						"description": "**User Login - Bearer Token Only (No Session Required)**\n\n**Security**: ADR-011 - Requires ONLY OAuth bearer token\n\n**Creates**:\n- HTTP session (saved in cookie)\n- Returns session_id in response\n\n**Credentials (default)**:\n- Email: admin\n- Password: admin\n- DB: realestate (auto-selected)\n\n**Post-login**:\n- Session ID automatically saved to environment\n- Use session_id for all subsequent authenticated requests\n\n**Test Script**:\n- Captures session_id from response AND cookies\n- Saves user_id and user_email for later use"
					},
					"response": []
				},
				{
					"name": "Get Current User (/me)",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Cookie",
								"value": "session_id={{session_id}}",
								"type": "text",
								"description": "Session cookie (required)"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"session_id\": \"{{session_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/me",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "me"]
						},
						"description": "**Get Current User - Requires Bearer Token + Session**\n\n**Security**: ADR-011 - Dual authentication\n- ‚úÖ Bearer token (Authorization header)\n- ‚úÖ Session ID (Cookie + request body)\n\n**Returns**:\n- User profile (id, name, email, login)\n- Accessible companies\n- Default company\n- Permissions\n\n**Session Validation**:\n- Session must be active (not expired/logged out)\n- Session fingerprint must match (IP/User-Agent/Language)\n- Returns 401 if session invalid or missing\n\n**Use Case**:\nFetch authenticated user data for SSR frontend hydration"
					},
					"response": []
				},
				{
					"name": "Update User Profile",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Cookie",
								"value": "session_id={{session_id}}",
								"type": "text",
								"description": "Session cookie (required)"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"session_id\": \"{{session_id}}\",\n    \"email\": \"updated.email@example.com\",\n    \"phone\": \"+55 11 99999-8888\",\n    \"mobile\": \"+55 11 98888-7777\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/users/profile",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "profile"]
						},
						"description": "**Update User Profile - Requires Bearer Token + Session**\n\n**Security**: ADR-011 - Dual authentication\n- ‚úÖ Bearer token (Authorization header)\n- ‚úÖ Session ID (Cookie + request body)\n\n**Editable Fields**:\n- email (must be unique)\n- phone\n- mobile\n\n**Validation**:\n- Email format validation\n- Email uniqueness check\n- Only authenticated user can edit own profile\n\n**Session Validation**:\n- Session fingerprint must match (prevents session hijacking)\n- Returns 401 if session invalid\n\n**Response**: Updated user profile data"
					},
					"response": []
				},
				{
					"name": "Change Password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Cookie",
								"value": "session_id={{session_id}}",
								"type": "text",
								"description": "Session cookie (required)"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"session_id\": \"{{session_id}}\",\n    \"current_password\": \"admin\",\n    \"new_password\": \"NewSecurePass123!\",\n    \"confirm_password\": \"NewSecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/users/change-password",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "change-password"]
						},
						"description": "**Change Password - Requires Bearer Token + Session**\n\n**Security**: ADR-011 - Dual authentication\n- ‚úÖ Bearer token (Authorization header)\n- ‚úÖ Session ID (Cookie + request body)\n\n**Validation Rules**:\n- ‚úÖ Current password must be correct\n- ‚úÖ New password minimum 8 characters\n- ‚úÖ New password must contain: uppercase, lowercase, number, special char\n- ‚úÖ Confirm password must match new password\n- ‚úÖ New password cannot be same as current\n\n**Session Validation**:\n- Session fingerprint must match\n- Returns 401 if session invalid\n\n**Security Features**:\n- Password hashed with bcrypt (cost factor 12)\n- Audit log entry created\n- All other sessions invalidated on success"
					},
					"response": []
				},
				{
					"name": "User Logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    // Clear session variables on successful logout",
									"    pm.environment.unset('session_id');",
									"    pm.collectionVariables.unset('session_id');",
									"    console.log('‚úÖ Logout successful - session cleared');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Cookie",
								"value": "session_id={{session_id}}",
								"type": "text",
								"description": "Session cookie (required)"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"session_id\": \"{{session_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/users/logout",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "logout"]
						},
						"description": "**User Logout - Requires Bearer Token + Session**\n\n**Security**: ADR-011 - Dual authentication (NEW as of 2026-01-16)\n- ‚úÖ Bearer token (Authorization header)\n- ‚úÖ Session ID (Cookie + request body) **[REQUIRED]**\n\n**What Happens**:\n1. Validates bearer token (401 if invalid/expired/revoked)\n2. Validates session (401 if missing/expired/fingerprint mismatch)\n3. Marks API session as inactive (PostgreSQL)\n4. Deletes session from Redis cache\n5. Clears session cookie\n6. Creates audit log entry\n\n**Session Validation**:\n- Session must exist and be active\n- Session fingerprint must match (IP/User-Agent/Language)\n- Returns 401 if session invalid or missing\n\n**Error Scenarios**:\n- 401: Missing Authorization header\n- 401: Token expired/revoked\n- 401: Session required (missing session_id)\n- 401: Session expired or not found\n- 401: Session validation failed (fingerprint mismatch)\n\n**Test Script**:\n- Automatically clears session_id from environment on success"
					},
					"response": []
				}
			],
			"description": "**User Authentication & Profile Management**\n\n**Updated**: 2026-01-16 (ADR-011 Session Validation)\n\n**Security Model** (Dual Authentication):\n- **Login**: Bearer token only (creates session)\n- **All other endpoints**: Bearer token + Session required\n\n**5 Endpoints**:\n1. Login - Bearer token only ‚úÖ\n2. /me - Bearer + Session ‚úÖ\n3. Profile - Bearer + Session ‚úÖ\n4. Change Password - Bearer + Session ‚úÖ\n5. Logout - Bearer + Session ‚úÖ (updated 2026-01-16)\n\n**Session Flow**:\n1. Call \"User Login\" ‚Üí receives session_id\n2. Session auto-saved to {{session_id}} variable\n3. All subsequent requests include session_id in Cookie header + body\n4. Call \"User Logout\" ‚Üí session invalidated\n\n**Session Validation**:\n- Redis-backed with 7200s TTL\n- Fingerprint validation (IP/User-Agent/Language)\n- Prevents session hijacking\n- Automatic expiration after logout or timeout"
		},
		{
			"name": "üë• 3. Agents Management",
			"item": [
				{
					"name": "List Agents",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents?page=1&limit=20&search=&active=true",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents"],
							"query": [
								{
									"key": "page",
									"value": "1",
									"description": "P√°gina (padr√£o: 1)"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Itens por p√°gina (max: 100)"
								},
								{
									"key": "search",
									"value": "",
									"description": "Busca por nome, email, CRECI"
								},
								{
									"key": "active",
									"value": "true",
									"description": "Filtrar ativos/inativos"
								},
								{
									"key": "company_id",
									"value": "1",
									"description": "Filtrar por empresa",
									"disabled": true
								}
							]
						},
						"description": "Lista agentes com pagina√ß√£o e filtros.\n\n**Multi-tenancy:** Apenas agentes da company do usu√°rio"
					},
					"response": []
				},
				{
					"name": "Create Agent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.id) {",
									"        pm.collectionVariables.set('agent_id', jsonData.id);",
									"        console.log('‚úÖ Agent criado, ID:', jsonData.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Maria Silva Santos\",\n    \"cpf\": \"123.456.789-09\",\n    \"email\": \"maria.silva@realestate.com\",\n    \"phone\": \"(11) 98765-4321\",\n    \"mobile\": \"(11) 91234-5678\",\n    \"creci\": \"CRECI/SP 123456-F\",\n    \"hire_date\": \"2024-01-15\",\n    \"birth_date\": \"1990-05-20\",\n    \"address\": \"Rua das Flores, 123\",\n    \"city\": \"S√£o Paulo\",\n    \"state\": \"SP\",\n    \"zip_code\": \"01234-567\",\n    \"commission_default_percentage\": 5.0,\n    \"specialization\": \"Im√≥veis Residenciais de Alto Padr√£o\",\n    \"active\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/agents",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents"]
						},
						"description": "Cria novo agente imobili√°rio.\n\n**Valida√ß√µes autom√°ticas:**\n- ‚úÖ CPF v√°lido (d√≠gitos verificadores)\n- ‚úÖ CRECI normalizado (CRECI/UF NNNNNN)\n- ‚úÖ Email √∫nico e formato v√°lido\n- ‚úÖ Phone formato brasileiro\n- ‚úÖ Company auto-atribu√≠da\n\n**Campos obrigat√≥rios:**\nname, cpf, email, creci\n\n**ID √© salvo automaticamente**"
					},
					"response": []
				},
				{
					"name": "Get Agent by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}"]
						},
						"description": "Retorna detalhes completos de um agente.\n\n**Inclui:**\n- Dados pessoais\n- CRECI normalizado\n- Count de im√≥veis\n- Count de regras de comiss√£o\n- M√©tricas de performance"
					},
					"response": []
				},
				{
					"name": "Update Agent",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Maria Silva Santos Corretora\",\n    \"email\": \"maria.corretora@realestate.com\",\n    \"phone\": \"(11) 99999-8888\",\n    \"mobile\": \"(11) 98888-7777\",\n    \"specialization\": \"Im√≥veis Comerciais e Residenciais\",\n    \"commission_default_percentage\": 6.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}"]
						},
						"description": "Atualiza dados de um agente.\n\n**Campos edit√°veis:**\nname, email, phone, mobile, creci, address, etc.\n\n**Campos protegidos:**\n‚ùå company_id (multi-tenancy)\n‚ùå cpf (imut√°vel)"
					},
					"response": []
				},
				{
					"name": "Deactivate Agent",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"reason\": \"Desligamento por decis√£o da empresa - Novo emprego em outra cidade\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/deactivate",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "deactivate"]
						},
						"description": "Desativa agente (soft delete).\n\n**Comportamento:**\n- active = False\n- Registra data e motivo\n- Preserva hist√≥rico\n- N√£o aparece em listas ativas\n- Pode ser reativado"
					},
					"response": []
				},
				{
					"name": "Reactivate Agent",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/reactivate",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "reactivate"]
						},
						"description": "Reativa agente desativado.\n\n**Comportamento:**\n- active = True\n- Limpa deactivation_date e reason\n- Volta a listagens ativas"
					},
					"response": []
				},
				{
					"name": "Get Agents Ranking",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/ranking?metric=total_commissions&period=month&limit=10",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "ranking"],
							"query": [
								{
									"key": "metric",
									"value": "total_commissions",
									"description": "total_commissions | total_sales | avg_ticket"
								},
								{
									"key": "period",
									"value": "month",
									"description": "week | month | quarter | year"
								},
								{
									"key": "limit",
									"value": "10",
									"description": "Top N agentes"
								}
							]
						},
						"description": "Ranking dos melhores agentes.\n\n**Crit√©rios:**\n- üí∞ total_commissions: Maior faturamento\n- üìà total_sales: Maior volume\n- üíµ avg_ticket: Maior ticket m√©dio\n\n**Multi-tenancy:** Apenas da company\n**Cache:** Redis 5min"
					},
					"response": []
				}
			],
			"description": "Agent CRUD + lifecycle management"
		},
		{
			"name": "üè† 4. Properties",
			"item": [
				{
					"name": "List Properties",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/properties?limit=20&offset=0&status=available",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "properties"],
							"query": [
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "offset",
									"value": "0"
								},
								{
									"key": "status",
									"value": "available",
									"description": "available|sold|rented|reserved"
								},
								{
									"key": "min_price",
									"value": "500000",
									"description": "Pre√ßo m√≠nimo",
									"disabled": true
								},
								{
									"key": "max_price",
									"value": "2000000",
									"description": "Pre√ßo m√°ximo",
									"disabled": true
								}
							]
						},
						"description": "Lista im√≥veis com filtros.\n\n**Multi-tenancy aplicado**"
					},
					"response": []
				},
				{
					"name": "Create Property",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.id) {",
									"        pm.collectionVariables.set('property_id', jsonData.id);",
									"        console.log('‚úÖ Property criado, ID:', jsonData.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Apartamento 3 quartos Vista Mar\",\n    \"property_type_id\": 2,\n    \"area\": 120.5,\n    \"zip_code\": \"11020-001\",\n    \"state_id\": 25,\n    \"city\": \"Santos\",\n    \"street\": \"Avenida Bartolomeu de Gusm√£o\",\n    \"street_number\": \"500\",\n    \"location_type_id\": 1,\n    \"price\": 850000.00,\n    \"rent_price\": 4500.00,\n    \"property_status\": \"available\",\n    \"property_purpose\": \"residential\",\n    \"num_rooms\": 3,\n    \"num_suites\": 1,\n    \"num_bathrooms\": 2,\n    \"num_parking\": 2,\n    \"total_area\": 145.0,\n    \"neighborhood\": \"Ponta da Praia\",\n    \"for_sale\": true,\n    \"for_rent\": true,\n    \"description\": \"<p>Apartamento amplo com vista privilegiada para o mar. Localiza√ß√£o nobre.</p>\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/properties",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "properties"]
						},
						"description": "Cria novo im√≥vel.\n\n**Campos obrigat√≥rios:**\nname, property_type_id, area, zip_code, state_id, city, street, street_number, location_type_id\n\n**Company auto-atribu√≠da**"
					},
					"response": []
				},
				{
					"name": "Get Property by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/properties/{{property_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "properties", "{{property_id}}"]
						},
						"description": "Busca im√≥vel por ID com todos os detalhes"
					},
					"response": []
				},
				{
					"name": "Update Property",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Apartamento 3 quartos Vista Mar - OPORTUNIDADE\",\n    \"price\": 800000.00,\n    \"description\": \"<p>Apartamento com vista mar - PRE√áO REDUZIDO!</p>\",\n    \"property_status\": \"reserved\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/properties/{{property_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "properties", "{{property_id}}"]
						},
						"description": "Atualiza im√≥vel existente"
					},
					"response": []
				}
			],
			"description": "Property CRUD operations"
		},
		{
			"name": "üìã 5. Assignments (Agent ‚Üî Property)",
			"item": [
				{
					"name": "Create Assignment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.id) {",
									"        pm.collectionVariables.set('assignment_id', jsonData.id);",
									"        console.log('‚úÖ Assignment criado, ID:', jsonData.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"agent_id\": {{agent_id}},\n    \"property_id\": {{property_id}},\n    \"responsibility_type\": \"seller\",\n    \"assignment_date\": \"2024-01-15\",\n    \"notes\": \"Agente respons√°vel pela venda deste im√≥vel\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/assignments",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "assignments"]
						},
						"description": "Atribui agente a im√≥vel.\n\n**Valida√ß√£o:**\n‚úÖ Agente e im√≥vel mesma company\n‚úÖ responsibility_type: seller | buyer | both\n‚úÖ M√∫ltiplos agentes permitidos"
					},
					"response": []
				},
				{
					"name": "List Agent Properties",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/properties",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "properties"]
						},
						"description": "Lista im√≥veis atribu√≠dos a um agente.\n\n**Retorna:**\n- Im√≥veis\n- Tipo responsabilidade\n- Data atribui√ß√£o"
					},
					"response": []
				},
				{
					"name": "Update Assignment",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"responsibility_type\": \"both\",\n    \"notes\": \"Agora respons√°vel por venda e capta√ß√£o de comprador\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/assignments/{{assignment_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "assignments", "{{assignment_id}}"]
						},
						"description": "Atualiza atribui√ß√£o existente"
					},
					"response": []
				}
			],
			"description": "Agent-to-Property assignments with validation"
		},
		{
			"name": "üí∞ 6. Commissions",
			"item": [
				{
					"name": "Create Commission Rule (Percentage)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.id) {",
									"        pm.collectionVariables.set('commission_rule_id', jsonData.id);",
									"        console.log('‚úÖ Commission Rule criado, ID:', jsonData.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"agent_id\": {{agent_id}},\n    \"transaction_type\": \"sale\",\n    \"structure_type\": \"percentage\",\n    \"percentage\": 6.0,\n    \"min_value\": 500000.00,\n    \"max_value\": 2000000.00,\n    \"valid_from\": \"2024-01-01\",\n    \"valid_until\": \"2024-12-31\",\n    \"description\": \"Comiss√£o 6% para vendas entre R$ 500k e R$ 2M\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/commission-rules",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "commission-rules"]
						},
						"description": "Cria regra de comiss√£o percentual.\n\n**Exemplo:** 6% vendas R$ 500k-2M\n\n**Valida√ß√µes:**\n‚úÖ percentage: 0-100\n‚úÖ min_value <= max_value\n‚úÖ dates v√°lidas"
					},
					"response": []
				},
				{
					"name": "List Agent Commission Rules",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/commission-rules?active_only=true",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "commission-rules"],
							"query": [
								{
									"key": "active_only",
									"value": "true",
									"description": "Apenas regras ativas"
								}
							]
						},
						"description": "Lista regras de comiss√£o do agente"
					},
					"response": []
				},
				{
					"name": "Update Commission Rule",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"percentage\": 7.0,\n    \"valid_until\": \"2025-12-31\",\n    \"description\": \"Comiss√£o aumentada para 7% - Performance excepcional\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/commission-rules/{{commission_rule_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "commission-rules", "{{commission_rule_id}}"]
						},
						"description": "Atualiza regra existente.\n\n‚ö†Ô∏è **N√£o √© retroativo**\n- Transa√ß√µes antigas mant√™m snapshot original\n- Apenas transa√ß√µes futuras usam nova regra"
					},
					"response": []
				},
				{
					"name": "Create Commission Transaction",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"agent_id\": {{agent_id}},\n    \"transaction_type\": \"sale\",\n    \"transaction_amount\": 1200000.00,\n    \"transaction_reference\": \"VENDA-2024-001\",\n    \"transaction_date\": \"2024-01-15\",\n    \"description\": \"Venda Apartamento Vista Mar - Santos/SP\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/commission-transactions",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "commission-transactions"]
						},
						"description": "Registra transa√ß√£o e calcula comiss√£o.\n\n**C√°lculo autom√°tico:**\n1. Busca regra ativa\n2. Aplica percentual/fixo\n3. Salva snapshot imut√°vel\n4. Retorna comiss√£o\n\n**Exemplo:** R$ 1.2M √ó 6% = R$ 72.000"
					},
					"response": []
				}
			],
			"description": "Commission rules and transaction calculation"
		},
		{
			"name": "üìä 7. Performance & Rankings",
			"item": [
				{
					"name": "Get Agent Performance",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/agents/{{agent_id}}/performance?start_date=2024-01-01&end_date=2024-12-31",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "agents", "{{agent_id}}", "performance"],
							"query": [
								{
									"key": "start_date",
									"value": "2024-01-01"
								},
								{
									"key": "end_date",
									"value": "2024-12-31"
								}
							]
						},
						"description": "M√©tricas de performance do agente.\n\n**Retorna:**\n- üí∞ total_commissions\n- üìà total_sales_count\n- üè† active_properties_count\n- üíµ avg_sale_value\n- üìä conversion_rate\n\n**Cache Redis:** 5 min"
					},
					"response": []
				}
			],
			"description": "Performance metrics and comparative rankings"
		},
		{
			"name": "üìö 8. Master Data",
			"item": [
				{
					"name": "Get Property Types",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/property-types",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "property-types"]
						},
						"description": "Lista tipos de im√≥veis (Casa, Apartamento, Terreno, etc)"
					},
					"response": []
				},
				{
					"name": "Get States",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/states",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "states"]
						},
						"description": "Lista estados brasileiros (27 UFs)"
					},
					"response": []
				},
				{
					"name": "Get Location Types",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/location-types",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "location-types"]
						},
						"description": "Lista tipos de localiza√ß√£o (Urbano, Rural, Praia, etc)"
					},
					"response": []
				},
				{
					"name": "Get Tags",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/tags",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "tags"]
						},
						"description": "Lista tags/marcadores de im√≥veis"
					},
					"response": []
				},
				{
					"name": "Get Amenities",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/amenities",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "amenities"]
						},
						"description": "Lista amenidades/comodidades (piscina, academia, etc)"
					},
					"response": []
				},
				{
					"name": "Get Owners",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/owners",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "owners"]
						},
						"description": "Lista propriet√°rios de im√≥veis"
					},
					"response": []
				},
				{
					"name": "Get Companies",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/companies",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "companies"]
						},
						"description": "Lista imobili√°rias (empresas do sistema)"
					},
					"response": []
				}
			],
			"description": "Reference data (types, states, tags, amenities)"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-inject token if exists",
					"const token = pm.collectionVariables.get('access_token') || pm.environment.get('access_token');",
					"if (token) {",
					"    pm.request.headers.add({key: 'Authorization', value: 'Bearer ' + token});",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Log response time",
					"console.log('‚è±Ô∏è Response time:', pm.response.responseTime, 'ms');",
					"",
					"// Check for errors",
					"if (pm.response.code >= 400) {",
					"    console.error('‚ùå Error:', pm.response.status);",
					"    console.error('Body:', pm.response.text());",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8069",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "refresh_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "agent_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "property_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "assignment_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "commission_rule_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string"
		}
	]
}
