{
  "info": {
    "_postman_id": "f008-tenant-lease-sale-api-collection",
    "name": "Feature 008 - Tenant, Lease & Sale API",
    "description": "REST API endpoints for tenant, lease, and sale management.\n\nFeature: 008-tenant-lease-sale-api\nEndpoints: 19 (Tenants: 6, Leases: 7, Sales: 5, Auth: 1)\n\nRequires OAuth token + session for all endpoints (except token).",
    "version": "1.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Authentication",
      "description": "OAuth token and user login for session",
      "item": [
        {
          "name": "Get OAuth Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData && jsonData.access_token) {",
                  "    pm.collectionVariables.set('access_token', jsonData.access_token);",
                  "    console.log('✅ Access token saved');",
                  "    if (jsonData.refresh_token) {",
                  "        pm.collectionVariables.set('refresh_token', jsonData.refresh_token);",
                  "        console.log('✅ Refresh token saved');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"client_id\": \"{{client_id}}\",\n  \"client_secret\": \"{{client_secret}}\",\n  \"grant_type\": \"client_credentials\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/token",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "token"]
            },
            "description": "**Public endpoint** — No auth headers needed.\nObtains OAuth 2.0 access token using client credentials.\nToken is auto-saved to collection variables."
          }
        },
        {
          "name": "User Login (Get Session)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "const sessionId = jsonData.session_id || (jsonData.result && jsonData.result.session_id);",
                  "if (sessionId) {",
                  "    pm.collectionVariables.set('session_id', sessionId);",
                  "    console.log('✅ Session ID saved: ' + sessionId.substring(0, 20) + '...');",
                  "}",
                  "const userId = jsonData.user_id || (jsonData.result && jsonData.result.user && jsonData.result.user.id);",
                  "if (userId) {",
                  "    pm.collectionVariables.set('user_id', userId);",
                  "    console.log('✅ User ID saved: ' + userId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"password\": \"{{user_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/users/login",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", "login"]
            },
            "description": "**Authentication:** Bearer Token required.\nLogs in a user and creates an API session.\nSession ID is auto-saved to collection variables."
          }
        }
      ]
    },
    {
      "name": "2. Tenants",
      "description": "Tenant CRUD operations (US1, US4, US5)\n\nEndpoints:\n- GET /tenants — List with pagination\n- POST /tenants — Create\n- GET /tenants/{id} — Get by ID\n- PUT /tenants/{id} — Update (+ reactivation)\n- DELETE /tenants/{id} — Archive (soft delete)\n- GET /tenants/{id}/leases — Lease history",
      "item": [
        {
          "name": "List Tenants",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/tenants?page=1&page_size=20",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants"],
              "query": [
                {"key": "page", "value": "1"},
                {"key": "page_size", "value": "20"},
                {"key": "is_active", "value": "true", "disabled": true}
              ]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nQuery parameters:\n- `page` (int, default 1)\n- `page_size` (int, default 20, max 100)\n- `is_active` (optional: 'false' to see archived)"
          }
        },
        {
          "name": "Create Tenant",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.id) {",
                  "    pm.collectionVariables.set('tenant_id', jsonData.data.id);",
                  "    console.log('✅ Tenant ID saved: ' + jsonData.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"João Silva\",\n  \"phone\": \"11999887766\",\n  \"email\": \"joao.silva@example.com\",\n  \"occupation\": \"Engineer\",\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/tenants",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `name`\nOptional: `phone`, `email`, `occupation`, `birthdate`\n\nAuto-saves `tenant_id` for subsequent requests."
          }
        },
        {
          "name": "Get Tenant by ID",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/tenants/{{tenant_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants", "{{tenant_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nReturns tenant details with HATEOAS links."
          }
        },
        {
          "name": "Update Tenant",
          "request": {
            "method": "PUT",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"11988776655\",\n  \"email\": \"updated@example.com\",\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/tenants/{{tenant_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants", "{{tenant_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nAll fields optional. Also supports reactivation: `{\"active\": true}`"
          }
        },
        {
          "name": "Archive Tenant (Soft Delete)",
          "request": {
            "method": "DELETE",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"No longer active tenant\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/tenants/{{tenant_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants", "{{tenant_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nSoft archive — sets active=false. Optional: `reason` in body."
          }
        },
        {
          "name": "Get Tenant Lease History",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/tenants/{{tenant_id}}/leases?page=1&page_size=20",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "tenants", "{{tenant_id}}", "leases"],
              "query": [
                {"key": "page", "value": "1"},
                {"key": "page_size", "value": "20"}
              ]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nReturns all leases (active + historical) for the tenant."
          }
        }
      ]
    },
    {
      "name": "3. Leases",
      "description": "Lease lifecycle management (US2)\n\nEndpoints:\n- GET /leases — List with pagination + filters\n- POST /leases — Create\n- GET /leases/{id} — Get by ID with renewal history\n- PUT /leases/{id} — Update (+ reactivation)\n- DELETE /leases/{id} — Archive\n- POST /leases/{id}/renew — Renew in-place\n- POST /leases/{id}/terminate — Early termination",
      "item": [
        {
          "name": "List Leases",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/leases?page=1&page_size=20",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases"],
              "query": [
                {"key": "page", "value": "1"},
                {"key": "page_size", "value": "20"},
                {"key": "property_id", "value": "", "disabled": true},
                {"key": "tenant_id", "value": "", "disabled": true},
                {"key": "status", "value": "", "disabled": true},
                {"key": "is_active", "value": "true", "disabled": true}
              ]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nFilters: `property_id`, `tenant_id`, `status` (draft/active/terminated/expired), `is_active`"
          }
        },
        {
          "name": "Create Lease",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.id) {",
                  "    pm.collectionVariables.set('lease_id', jsonData.data.id);",
                  "    console.log('✅ Lease ID saved: ' + jsonData.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"property_id\": {{property_id}},\n  \"tenant_id\": {{tenant_id}},\n  \"start_date\": \"2026-03-01\",\n  \"end_date\": \"2027-02-28\",\n  \"rent_amount\": 2500.00,\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/leases",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `property_id`, `tenant_id`, `start_date`, `end_date`, `rent_amount`\nValidations: rent > 0, dates ordered, no concurrent lease on same property\n\nAuto-saves `lease_id`."
          }
        },
        {
          "name": "Get Lease by ID",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/leases/{{lease_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases", "{{lease_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nReturns lease details with property, tenant info, and renewal history."
          }
        },
        {
          "name": "Update Lease",
          "request": {
            "method": "PUT",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rent_amount\": 2800.00,\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/leases/{{lease_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases", "{{lease_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nCannot update terminated/expired leases. Supports reactivation: `{\"active\": true}`"
          }
        },
        {
          "name": "Archive Lease (Soft Delete)",
          "request": {
            "method": "DELETE",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/leases/{{lease_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases", "{{lease_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nSoft archive — sets active=false."
          }
        },
        {
          "name": "Renew Lease",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"new_end_date\": \"2028-02-28\",\n  \"new_rent_amount\": 3000.00,\n  \"reason\": \"Annual renewal with adjustment\",\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/leases/{{lease_id}}/renew",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases", "{{lease_id}}", "renew"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `new_end_date` (must be after current end_date)\nOptional: `new_rent_amount`, `reason`\n\nCreates a renewal history record and updates lease in-place."
          }
        },
        {
          "name": "Terminate Lease",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"termination_date\": \"2026-06-30\",\n  \"reason\": \"Tenant relocation\",\n  \"penalty_amount\": 5000.00,\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/leases/{{lease_id}}/terminate",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "leases", "{{lease_id}}", "terminate"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `termination_date`\nOptional: `reason`, `penalty_amount`\n\nSets lease status to 'terminated'. Only active leases can be terminated."
          }
        }
      ]
    },
    {
      "name": "4. Sales",
      "description": "Sale registration and management (US3)\n\nEndpoints:\n- GET /sales — List with pagination + filters\n- POST /sales — Create (marks property as sold)\n- GET /sales/{id} — Get by ID\n- PUT /sales/{id} — Update (+ reactivation)\n- POST /sales/{id}/cancel — Cancel (reverts property status)",
      "item": [
        {
          "name": "List Sales",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/sales?page=1&page_size=20",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "sales"],
              "query": [
                {"key": "page", "value": "1"},
                {"key": "page_size", "value": "20"},
                {"key": "property_id", "value": "", "disabled": true},
                {"key": "agent_id", "value": "", "disabled": true},
                {"key": "status", "value": "", "disabled": true},
                {"key": "min_price", "value": "", "disabled": true},
                {"key": "max_price", "value": "", "disabled": true},
                {"key": "is_active", "value": "true", "disabled": true}
              ]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nFilters: `property_id`, `agent_id`, `status` (completed/cancelled), `min_price`, `max_price`, `is_active`"
          }
        },
        {
          "name": "Create Sale",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.id) {",
                  "    pm.collectionVariables.set('sale_id', jsonData.data.id);",
                  "    console.log('✅ Sale ID saved: ' + jsonData.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"property_id\": {{property_id}},\n  \"company_id\": {{company_id}},\n  \"buyer_name\": \"Maria Santos\",\n  \"buyer_phone\": \"11999887766\",\n  \"buyer_email\": \"maria@example.com\",\n  \"sale_date\": \"2026-03-15\",\n  \"sale_price\": 450000.00,\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/sales",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "sales"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `property_id`, `company_id`, `buyer_name`, `sale_date`, `sale_price`\nOptional: `buyer_phone`, `buyer_email`, `agent_id`, `lead_id`\n\nSide effect: Property status set to 'sold'.\nAuto-saves `sale_id`."
          }
        },
        {
          "name": "Get Sale by ID",
          "request": {
            "method": "GET",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"},
              {"key": "X-Openerp-Session-Id", "value": "{{session_id}}"}
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/sales/{{sale_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "sales", "{{sale_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session ID required\n\nReturns sale details with property, agent, and lead info."
          }
        },
        {
          "name": "Update Sale",
          "request": {
            "method": "PUT",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"buyer_name\": \"Maria Santos Updated\",\n  \"buyer_phone\": \"11988776655\",\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/sales/{{sale_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "sales", "{{sale_id}}"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nCannot update cancelled sales. Supports reactivation: `{\"active\": true}`"
          }
        },
        {
          "name": "Cancel Sale",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{access_token}}"},
              {"key": "User-Agent", "value": "{{user_agent}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Buyer withdrew from deal\",\n  \"session_id\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/sales/{{sale_id}}/cancel",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "sales", "{{sale_id}}", "cancel"]
            },
            "description": "**Authentication:** Bearer Token + Session (in body) required\n\nRequired: `reason`\n\nSide effect: Property status reverted from 'sold'."
          }
        }
      ]
    }
  ],
  "variable": [
    {"key": "base_url", "value": "http://localhost:8069", "type": "string"},
    {"key": "client_id", "value": "", "type": "string"},
    {"key": "client_secret", "value": "", "type": "string"},
    {"key": "access_token", "value": "", "type": "string"},
    {"key": "refresh_token", "value": "", "type": "string"},
    {"key": "session_id", "value": "", "type": "string"},
    {"key": "user_agent", "value": "PostmanRuntime/7.26.8", "type": "string"},
    {"key": "user_email", "value": "admin@example.com", "type": "string"},
    {"key": "user_password", "value": "admin", "type": "string"},
    {"key": "tenant_id", "value": "", "type": "string"},
    {"key": "lease_id", "value": "", "type": "string"},
    {"key": "sale_id", "value": "", "type": "string"},
    {"key": "property_id", "value": "1", "type": "string"},
    {"key": "company_id", "value": "1", "type": "string"},
    {"key": "user_id", "value": "", "type": "string"}
  ]
}
